<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBA STUDIO | V21 ELITE</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0c;
            --ui-panel: rgba(20, 20, 25, 0.9);
            --accent: #00f2ff;
            --border: #2a2a32;
            --text: #ececed;
            --text-dim: #6e6e77;
            --rec: #ff2a54;
        }

        * {
            box-sizing: border-box;
            outline: none;
            user-select: none;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            display: grid;
            grid-template-columns: 260px 1fr 280px;
            grid-template-rows: 60px 1fr 180px;
            height: 100vh;
            overflow: hidden;
        }

        header {
            grid-column: 1/4;
            background: var(--ui-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            z-index: 100;
        }

        aside {
            background: var(--ui-panel);
            border-right: 1px solid var(--border);
            padding: 20px;
        }

        #right-sidebar {
            border-right: none;
            border-left: 1px solid var(--border);
        }

        .brand {
            font-weight: 900;
            font-size: 13px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .brand span {
            color: var(--accent);
        }

        main {
            grid-column: 2;
            background-color: #0d0d11;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .canvas-wrapper {
            border: 1px solid var(--border);
            background: #000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .btn {
            background: #1c1c24;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
        }

        .btn-p {
            background: var(--accent);
            color: #000;
            border: none;
        }

        footer {
            grid-column: 1/4;
            background: var(--ui-panel);
            border-top: 1px solid var(--border);
            display: grid;
            grid-template-columns: 260px 1fr;
        }

        #frames-track {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.2);
        }

        .keyframe {
            min-width: 60px;
            height: 60px;
            background: #14141a;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
        }

        .keyframe.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        .label {
            font-size: 9px;
            font-weight: 900;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <header>
        <div class="brand">OBA Studio <span>V21 ELITE</span></div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-p" onclick="addRig()">+ Add Stickman</button>
            <button class="btn" onclick="togglePlayback()" id="playBtn">â–¶ Play</button>
            <button class="btn" style="background:#ff2a54; border:none;" onclick="exportWebM()">Export</button>
        </div>
    </header>

    <aside>
        <div class="label">Layers</div>
        <div id="layer-list"></div>
    </aside>

    <main>
        <div class="canvas-wrapper">
            <canvas id="c" width="800" height="450"></canvas>
        </div>
    </main>

    <aside id="right-sidebar">
        <div class="label">Properties</div>
        <div style="font-size:11px; color:var(--text-dim); line-height:2;">
            Rigging: <span style="color:#fff">Fixed Constraints</span><br>
            Hotkeys: <span style="color:var(--accent)">[F] Keyframe</span>
        </div>
    </aside>

    <footer>
        <div style="padding:20px;"><button class="btn btn-p" style="width:100%; height:50px;"
                onclick="addKeyframe()">Capture Frame [F]</button></div>
        <div id="frames-track"></div>
    </footer>

    <script>
        const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
        let rigs = [], keyframes = [], curFrame = 0, isPlaying = false, dragObj = null;

        class Stickman {
            constructor(x, y) {
                this.x = x; this.y = y;
                // Angles for limbs (Fully Sticked logic)
                this.pose = { head: -Math.PI / 2, lArm: 2.5, rArm: 0.6, lLeg: 1.8, rLeg: 1.3 };
                this.lengths = { torso: 80, arm: 50, leg: 60, head: 22 };
            }
            draw(c) {
                const rootX = this.x, rootY = this.y;
                c.lineCap = "round"; c.lineWidth = 5; c.strokeStyle = "#fff";

                // Calculate Joint Positions (Fixed to Torso)
                const neckX = rootX, neckY = rootY - this.lengths.torso;
                const lHandX = neckX + Math.cos(this.pose.lArm) * this.lengths.arm;
                const lHandY = neckY + Math.sin(this.pose.lArm) * this.lengths.arm;
                const rHandX = neckX + Math.cos(this.pose.rArm) * this.lengths.arm;
                const rHandY = neckY + Math.sin(this.pose.rArm) * this.lengths.arm;
                const lFootX = rootX + Math.cos(this.pose.lLeg) * this.lengths.leg;
                const lFootY = rootY + Math.sin(this.pose.lLeg) * this.lengths.leg;
                const rFootX = rootX + Math.cos(this.pose.rLeg) * this.lengths.leg;
                const rFootY = rootY + Math.sin(this.pose.rLeg) * this.lengths.leg;

                // Draw Body
                c.beginPath();
                c.moveTo(rootX, rootY); c.lineTo(neckX, neckY); // Spine
                c.moveTo(neckX, neckY); c.lineTo(lHandX, lHandY); // L-Arm
                c.moveTo(neckX, neckY); c.lineTo(rHandX, rHandY); // R-Arm
                c.moveTo(rootX, rootY); c.lineTo(lFootX, lFootY); // L-Leg
                c.moveTo(rootX, rootY); c.lineTo(rFootX, rFootY); // R-Leg
                c.stroke();

                // The Head (Un-detachable)
                c.fillStyle = "#000"; c.strokeStyle = "#00f2ff"; c.lineWidth = 4;
                c.shadowBlur = 10; c.shadowColor = "#00f2ff";
                c.beginPath(); c.arc(neckX, neckY - 20, this.lengths.head, 0, Math.PI * 2);
                c.fill(); c.stroke(); c.shadowBlur = 0;

                // Control Points
                this.drawDot(c, rootX, rootY, "#00f2ff", "root");
                this.drawDot(c, lHandX, lHandY, "#fff", "lArm");
                this.drawDot(c, rHandX, rHandY, "#fff", "rArm");
                this.drawDot(c, lFootX, lFootY, "#fff", "lLeg");
                this.drawDot(c, rFootX, rFootY, "#fff", "rLeg");
            }
            drawDot(c, x, y, col, id) {
                c.fillStyle = col; c.beginPath(); c.arc(x, y, 6, 0, Math.PI * 2); c.fill();
                jointPoints.push({ x, y, id, parent: this });
            }
        }

        let jointPoints = [];
        function render() {
            ctx.fillStyle = "#000"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            jointPoints = [];
            rigs.forEach(r => r.draw(ctx));
        }

        canvas.onmousedown = (e) => {
            const rect = canvas.getBoundingClientRect(), mx = e.clientX - rect.left, my = e.clientY - rect.top;
            dragObj = jointPoints.find(p => Math.hypot(p.x - mx, p.y - my) < 15);
        };

        window.onmousemove = (e) => {
            if (!dragObj) return;
            const rect = canvas.getBoundingClientRect(), mx = e.clientX - rect.left, my = e.clientY - rect.top;
            const r = dragObj.parent;
            if (dragObj.id === "root") { r.x = mx; r.y = my; }
            else {
                const originX = (dragObj.id.includes("Leg")) ? r.x : r.x;
                const originY = (dragObj.id.includes("Leg")) ? r.y : r.y - r.lengths.torso;
                r.pose[dragObj.id] = Math.atan2(my - originY, mx - originX);
            }
            render();
        };
        window.onmouseup = () => dragObj = null;

        function addRig() { rigs.push(new Stickman(400, 300)); render(); }
        function addKeyframe() { keyframes.push(JSON.stringify(rigs)); updateTimeline(); }
        function updateTimeline() {
            const track = document.getElementById('frames-track'); track.innerHTML = '';
            keyframes.forEach((k, i) => {
                const d = document.createElement('div'); d.className = 'keyframe'; d.innerText = i + 1;
                d.onclick = () => { rigs = JSON.parse(keyframes[i]).map(o => Object.assign(new Stickman(), o)); render(); };
                track.appendChild(d);
            });
        }

        function togglePlayback() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                let i = 0;
                const loop = setInterval(() => {
                    if (!isPlaying) { clearInterval(loop); return; }
                    rigs = JSON.parse(keyframes[i]).map(o => Object.assign(new Stickman(), o));
                    render(); i = (i + 1) % keyframes.length;
                }, 200);
            }
        }

        window.onkeydown = (e) => { if (e.key.toLowerCase() === 'f') addKeyframe(); };
        addRig();
    </script>
</body>

</html>